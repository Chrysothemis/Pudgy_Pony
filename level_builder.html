<!DOCTYPE html>
<head>	
	<script type="text/javascript" src="crafty.js"></script>
    <link rel="stylesheet" type="text/css" href="site.css" />
    <link rel="stylesheet" type="text/css" href="960/reset.css" />
    <link rel="stylesheet" type="text/css" href="960/text.css" />
    <link rel="stylesheet" type="text/css" href="960/960.css" />
</head>
<body>
 <div id="Everything_Box" class="container_12">
    <div " class="grid_12">
       <p id="logo">Ava-chat<p>
      
    </div>
    <div id="main_game_div" class="grid_12" style="text-align: center;">
    
        <div id="cr-stage">
<script type="text/javascript">

            var width = 940;
            Crafty.init(width, 680);
            
            var color = 'rgb(255,0,0)'; 
            
            //turn the sprite maps into usable components
            Crafty.sprite(20, "cat.png", {
                cat: [0, 0],
                rev_cat:[0,1]
            });
            Crafty.sprite(20, "sprites_1.png", {
                inbrick: [0, 0],
                brick: [1, 0],
                window:[0, 1],
                roof1:[0,2,2,1],
                roof2:[0,3,2,1],
                roof3:[0,4],
                door:[0,5,1,2],
                indoor:[1,5,1,2],
            });

            
            Crafty.scene("loading", function () {
                //load takes an array of assets and a callback when complete
                Crafty.load(["cat.png", "bg3.png", "sprites_1.png"], function () {
                    Crafty.scene("main"); //when everything is loaded, run the main scene
                });
            
                //black background with some loading text
                //Crafty.background("#000");
                Crafty.e("2D, DOM, Text").attr({ w: 100, h: 20, x: 150, y: 120 })
                    .text("Loading")
                    .css({ "text-align": "center" });
            });
            
            //automatically play the loading scene
            Crafty.scene("loading");

            Crafty.scene("main", function () {
                Crafty.background( Crafty.e("2D, DOM, Image").image("bg3.png"));
                
       
               //pallet selection
               Crafty.e('Selection, 2D, DOM, Color')
                .attr({ x: 60, y: 620, w: 24, h: 24}) 
                .color(color)
                
                .bind("EnterFrame", function () {
       
                    if(media == 0){
                        
                        this.x = 58;
                        this.y=618;
                        this.w = 24;
                        this.h = 24;
                    }else if(media ==1){
                        this.x = 88;
                        this.y=618;
                        this.w = 24;
                        this.h = 24;
                    }else if(media ==2){
                        this.x = 828;
                        this.y=618;
                        this.w = 24;
                        this.h = 24;                    
                    }else if(media ==3){
                        this.x = 128;
                        this.y=618;
                        this.w = 44;
                        this.h = 24;                    
                    }else if(media ==4){
                        this.x = 179;
                        this.y=618;
                        this.w = 24;
                        this.h = 24;                    
                    }else if(media ==5){
                        this.x = 208;
                        this.y=618;
                        this.w = 44;
                        this.h = 24;                        
                    }else if(media ==6){
                        this.x = 473;
                        this.y=618;
                        this.w = 24;
                        this.h = 44;                        
                    }else if(media ==7){
                        this.x = 28;
                        this.y=618;
                        this.w = 24;
                        this.h = 24;                        
                    }else if(media ==8){
                        this.x = 428;
                        this.y=618;
                        this.w = 24;
                        this.h = 44;                        
                    }
                })
                //pallet items
                Crafty.e('Media_0, 2D, DOM, brick, Mouse, Pallet_item')
                    .attr({ x: 60, y: 620, w: 20, h: 20})       
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 0; 
                        })
                    })
                    
                Crafty.e('Media_1, 2D, DOM, window, Mouse')
                    
                    .attr({ x: 90, y: 620, w: 20, h: 20})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 1; 
                        })
                    })

                 Crafty.e("Media_2, 2D, DOM, cat, , Mouse")
                    .attr({x: 830, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 2; 
                        })
                    })
                Crafty.e('Media_3, 2D, DOM, roof1, Mouse')
                    
                    .attr({ x: 130, y: 620})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 3; 
                        })
                    })

                 Crafty.e("Media_4, 2D, DOM, roof3, Mouse")
                    .attr({x: 180, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 4; 
                        })
                    })

                 Crafty.e("Media_5, 2D, DOM, roof2,  Mouse")
                    .attr({x:210, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 5; 
                        })
                    })
                    
                 Crafty.e("Media_6, 2D, DOM, door,  Mouse")
                    .attr({x:475, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 6; 
                        })
                    })

                    Crafty.e("Media_7, 2D, DOM, inbrick,  Mouse")
                    .attr({x:30, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 7; 
                        })
                    })
                    
                 Crafty.e("Media_8, 2D, DOM, indoor,  Mouse")
                    .attr({x:430, y: 620 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 8; 
                        })
                    })
                    
                    //Crafty.e("Save_Test, 2D, DOM, rev_cat,  Mouse")
                    //.attr({x:30, y: 620 })
                           
                    //.bind("Click", function () {
                       // var ent = Crafty.e("2D, DOM, Color")
                       //     .attr({x: 20, y: 20, w: 100, h:100})
                       //     .color(color);
                      //  Crafty.storage.open('MyGame');
                      //  Crafty.storage.save('MyEntity', 'save', ent);
                    //})
                    
                    
                //Mover
                Crafty.c("Mover" ,{
                    init: function(){
                        this.requires('SpriteAnimation');
                    },

                    
                        walk: function(){
                            //if(!this.isPlaying())
                            if( Crafty.math.randomInt(0, 5) < this.speed){
                                if(this.dX == 1 ){
                                    this.animate('right', 3);
                                }else{
                                    this.animate('left', 3);
                                }
                                if(this.x > (width-20) || this.x < 9){
                                    this.turnAround();
                                }
                                else{
                                     if( Crafty.math.randomInt(0, 100) < this.turnFactor){
                                        this.turnAround();
                                     }else{
                                        this.x = this.x + this.dX;
                                    }
                                }
                            }
                        },
                        
                    turnAround: function(){
                            this.dX *= -1;
                            this.x = this.x + this.dX;
                    }
                
                });
                
                //Floor            
                Crafty.e("Floor, 2D, DOM, Color, Solid, SuperSolid")
                    .attr({x: 10, y: 570, w: width-19, h: 20 })
                    .color("green")

                //NPCs
                    //Dolly
                Crafty.e("NPC, 2D, DOM, npc, Collision, Mover")
                    .attr({x: 15, y: 530, z:100, dX:1, speed:2, turnFactor:5})
                    .animate('right', 0, 0, 3)
                    .animate('left', 0, 2, 3)
                    
                    .bind("EnterFrame", function () {
                        this.walk();
                    })
                    .onHit("SuperSolid", function(){
                           this.turnAround();       
                    })
                    
                   //Pitys
                Crafty.e("NPC, 2D, DOM, pitys, Collision, SpriteAnimation")
                    .attr({x: 400, y: 530, z:100, dX:1})
                    .animate('sit', 0, 2, 3)
                    
                    .bind("EnterFrame", function () {
                        this.animate('sit', 3);
                    })

                   //Judy
                Crafty.e("NPC, 2D, DOM, judy, Collision, SpriteAnimation")
                    .attr({x: 700, y: 530, z:100, dX:1})
                    .animate('stand', 0, 0, 3)
                    
                    .bind("EnterFrame", function () {
                        this.animate('stand', 3);
                    })
                    
                //Brush
                Crafty.e("Brush, 2D, DOM, Color, Multiway")
                    .color(color)
                    .attr({ x: 200, y: 210, w: 20, h: 20, z:100000})
                    //.multiway(10, { UP_ARROW: -90, DOWN_ARROW: 90, LEFT_ARROW: 180, RIGHT_ARROW: 0 })
                    
                    .bind('EnterFrame', function () {
                       // hit floor or roof
                        if (this.y <= 20 )
                            this.y = 20;
                        if (this.y >= 860 )
                            this.y = 860;
                            
                                     
                
                        if (unreadPost){
                            pst = document.getElementById('PostBox').value;
                            Crafty("PlayerPost").text("    " + pst); 
                            unreadPost = false;
                                    p += 100;
                            
                        }
                    })                     

                    .bind("KeyDown", function (e) {
                        

                        if (e.key == Crafty.keys['ENTER'] ){    
                            if (media == 0){ 
                                if (p >= 10){
                                    Crafty.e('2D, DOM, brick, Collision, Gravity, Solid, SuperSolid')
                                        //.color("blue")
                                        .attr({
                                        w: 20,
                                        h: 20,
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p -= 10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }
                                }
                            } else if (media == 1){
                                if (p >= 10){
                                    Crafty.e('2D, DOM,  window, SpriteAnimation, Collision, Gravity, Solid')
                                        .attr({
                                            w: 20,
                                            h: 20,
                                            x: this.x,
                                            y: this.y
                                        })
                                        .collision()
                                        .animate('window', 0, 1, 1)
                                        .bind("EnterFrame", function () {
                                            if(!this.isPlaying())
                                                this.animate('window', 800);
                                        })
                                        .gravity("Solid")
                                    p-=10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }
                                }                              
                            } else if(media == 2){
                                if (p >= 50){
                                    Crafty.e("2D, DOM, cat, SpriteAnimation, Gravity, Collision, Mover")
                                        .attr({
                                        x: this.x,
                                        y: this.y,
                                        z: 100000,
                                        dX: 1,
                                        speed:5,
                                        turnFactor:1
                                        })

                                        .animate('right', 0, 0, 2)
                                        .animate('left', 0, 1, 2)
                                        
                                        .bind("EnterFrame", function () {
                                            this.walk();
                                        })
                                        .onHit("SuperSolid", function(){
                                               this.turnAround();       
                                        })
                                        .gravity("SuperSolid")
                                    p -= 50;
                                    a += 1;                                    
                                }
                            } else if(media == 3){
                                if (p >= 10){
                                    Crafty.e("2D, DOM, roof1, Gravity, Solid, SuperSolid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p -= 10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }
                                 }
                            } else if(media == 4){
                                if (p >= 10){
                                    Crafty.e("2D, DOM, roof3, Gravity, Solid, SuperSolid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p-=10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }
                                }    
                            } else if(media == 5){
                                if (p >= 10){
                                    Crafty.e("2D, DOM, roof2, Gravity, Solid, SuperSolid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p-=10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }
                                }
                            }else if(media == 6){
                                if (p >= 20){
                                    Crafty.e("2D, DOM, door, Gravity, Solid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p-=20;
                                    if(this.x < 313 )
                                        d +=2;
                                    else if (this.x < 626){
                                        pt +=2;
                                    }else{
                                        ju +=2;
                                    }
                                }
                            }else if(media == 7){
                                if (p >= 10){
                                    Crafty.e("2D, DOM, inbrick, Gravity, Solid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p-=10;
                                    if(this.x < 313 )
                                        d +=1;
                                    else if (this.x < 626){
                                        pt +=1;
                                    }else{
                                        ju +=1;
                                    }                                    
                                }
                            }else if(media == 8){
                                if (p >= 20){
                                    Crafty.e("2D, DOM, indoor, Gravity, Solid")
                                        .attr({
                                        x: this.x,
                                        y: this.y
                                        })
                                        .gravity("Solid")
                                    p-=20;
                                    if(this.x < 313 )
                                        d +=2;
                                    else if (this.x < 626){
                                        pt +=2;
                                    }else{
                                        ju +=2;
                                    }
                                }

                        }        
                        } else if (e.key == Crafty.keys['UP_ARROW'] ){
                                this.y = this.y - 20;
                        }else if (e.key == Crafty.keys['DOWN_ARROW'] ){
                                this.y = this.y + 20;
                        }else if (e.key == Crafty.keys['LEFT_ARROW'] ){
                                this.x = this.x - 20;
                        }else if (e.key == Crafty.keys['RIGHT_ARROW'] ){
                                this.x = this.x + 20;
                        }
                    
                 })
                        

            })
            
            function newPost(){
                unreadPost = true;
            }
            
             //Message 
            Crafty.e("Message, DOM")
                .bind("EnterFrame", function () {
                    if (unreadPost){                     
                        p = p + 100;
                   }
                   document.getElementById('annameter').value =  a;
                   document.getElementById('pointbox').value =  p;
                   document.getElementById('dollymeter').value =  d;
                   document.getElementById('pitysmeter').value =  pt;
                   document.getElementById('judymeter').value =  ju;
                })
            
            //Crafty.addEntityFactory('Wall', function() {
            //      var entity = Crafty.e('2D, DOM, Color, Collision')
             //     .color("blue")
             //     .attr({
              //      w: 20,
                //    h: 20,
                  //  x: Crafty("Brush").x,
                   // y: Crafty("Brush").y
                  //})
                  //.addComponent('Gravity').gravity("Floor");

                  //return entity;
                //})
        
</script>
        </div>
    </div>
    <!-- <div id="Meters" class="grid_8 push_2"> -->
    <div id="Meters" class="grid_12" style="text-align: center;"push_2>
        <a href="https://github.com/Prgnization/game-off-2012/blob/master/README.md">How to Play</a>
        <p>Post New Message: <input  id = "PostBox" name="post" value="   Hello!"><input type="button" value="Post!" onClick=newPost();> Current Points <input  id = "pointbox" name="pointbox" readonly="readonly" ></p>
        <p>Friendship Meters:</p> 
        <p>Dolly: <input  id = "dollymeter" readonly="readonly" > Pitys: <input  id = "pitysmeter" readonly="readonly" ></p><p>Judy:  <input  id = "judymeter" readonly="readonly" > Anna: <input  id = "annameter" readonly="readonly" > </p>
        
    </div>
 </div>
</body>
</html>
